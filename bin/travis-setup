#!/bin/bash
# Script, which is run before travis build.
# Installs some dependency, depending on on which OS travis is running.

# shellcheck source=./travis-share.sh
_dir="$( dirname "$0" )"
source "${_dir}/travis-share.sh"
unset _dir

function run_install {
case "$TRAVIS_OS_NAME" in
  "linux")
    try_run 'sudo apt-get update'
    try_run 'sudo apt-get install -y
      curl
      build-essential
      libasound2-dev
      libpulse-dev
      portaudio19-dev
      libsdl2-dev'

    # Kind of ironic, that ubuntu is the only one of these OSes,
    # that doesn't have `gdrive` available in their main repos.
    local GDRIVE_DOWNLOAD="https://github.com/gdrive-org/gdrive/releases/download/2.1.0/gdrive-linux-x64"
    try_run "sudo sh -c 'curl -L $GDRIVE_DOWNLOAD > /bin/gdrive'"
    sudo chmod +x /bin/gdrive
    ;;

  "windows")
    try_run 'choco install
      grep
      gdrive'
    ;;

  "osx")
    check "brew"
    try_run 'brew update'
    try run 'brew install SDL2 gdrive'
    ;;

  *)
    err "Unrecognized OS $( colored "$COLOR_CODE" "$TRAVIS_OS_NAME" )"
    ;;
esac
}

      run_install
